<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VendoRaiz - Listado Inicial</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
    <h1 id="main-title">Propiedades Exclusivas en Venta</h1>
<div id="add-propiedad-form" style="max-width: 600px; margin: 0 auto 40px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
    <h2>Añadir Nueva Propiedad</h2>
    <input type="text" id="new-titulo" placeholder="Título de la Propiedad (ej: Casa moderna)" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
    <input type="number" id="new-precio" placeholder="Precio (ej: 4500000)" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
    <input type="text" id="new-ciudad" placeholder="Ciudad (ej: Ciudad de México)" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
    <input type="text" id="new-imagen" placeholder="URL de Imagen (ej: https://picsum.photos/400/300)" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
    <button id="btn-add-propiedad" style="width: 100%; padding: 10px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Añadir Propiedad</button>
    <p id="form-message" style="margin-top: 10px; text-align: center; color: green;"></p>
    # Crear un campo en el HTML para que el usuario escriba la ciudad. Para filtro por Cd 
    <h2 style="margin-top: 25px;">Buscar Propiedades por Ciudad</h2>
    <input type="text" id="filtro-ciudad" placeholder="Escribe la ciudad para buscar (ej: Cancún)" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
    <button id="btn-buscar" style="width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Buscar</button>
    <button id="btn-mostrar-todo" style="width: 100%; padding: 10px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 5px;">Mostrar Todas</button>
</div>
    <div id="propiedades-container">
        <p>Cargando listado...</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    
    <script>
    // 2. TUS CONFIGURACIONES DE PROYECTO (¡ESTO DEBE ESTAR YA CORRECTO!)
    const firebaseConfig = {
        // [TUS DATOS REALES DE CONFIGURACIÓN]
            apiKey: "AIzaSyAKXariRWtQooeoENvDLSEPJJGYE8eQ7nM",
            authDomain: "marketplace-inmobiliario-beta.firebaseapp.com",
            projectId: "marketplace-inmobiliario-beta",
            storageBucket: "marketplace-inmobiliario-beta.firebasestorage.app",
            messagingSenderId: "639523806499",
            appId: "1:639523806499:web:5b91af6866cba34ae28096",
            measurementId: "G-XVVLXJEYK0"
    };

    // 3. Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 4. Código para leer TODAS las propiedades
    db.collection("propiedades").get().then((querySnapshot) => {
        const contenedor = document.getElementById('propiedades-container');
        let htmlContent = ''; // Variable para construir todo el HTML
        
        if (querySnapshot.empty) {
            contenedor.innerHTML = "<h1>No se encontraron propiedades en la base de datos.</h1>";
            return;
        }

        querySnapshot.forEach((doc) => {
            const data = doc.data();
            // Creamos una "tarjeta" simple para cada propiedad
            htmlContent += `
        <div class="propiedad-card">
            <img src="${data.urlImagen}" alt="${data.titulo}">
            <div class="propiedad-details">
                <h2>${data.titulo}</h2>
                <p><strong>Ciudad:</strong> ${data.ciudad}</p>
                <p><strong>Precio:</strong> $${data.precio}</p>
            </div>
        </div>
    `;
        });
        
        contenedor.innerHTML = htmlContent; // Insertamos todas las tarjetas de golpe

    }).catch((error) => {
        console.error("Error al leer Firestore: ", error);
        document.getElementById('propiedad-info').innerHTML = "<h1>Error de conexión al obtener el listado.</h1>";
    });
    // === CÓDIGO PARA AÑADIR PROPIEDADES (MINI STEP 7.2) ===

    document.getElementById('btn-add-propiedad').addEventListener('click', addPropiedad);

    function addPropiedad() {
        // 1. Obtener valores del formulario
        const titulo = document.getElementById('new-titulo').value;
        const precio = parseFloat(document.getElementById('new-precio').value); // Convertir a número
        const ciudad = document.getElementById('new-ciudad').value;
        const urlImagen = document.getElementById('new-imagen').value || 'https://via.placeholder.com/400x300.png?text=No+Image'; // Si está vacío, usar placeholder

        const messageDisplay = document.getElementById('form-message');

        // 2. Validación simple
        if (!titulo || !precio || !ciudad) {
            messageDisplay.textContent = "Error: Título, Precio y Ciudad son obligatorios.";
            messageDisplay.style.color = 'red';
            return;
        }

        // 3. Objeto de datos para Firestore
        const nuevaPropiedad = {
            titulo: titulo,
            precio: precio,
            ciudad: ciudad,
            urlImagen: urlImagen,
            timestamp: firebase.firestore.FieldValue.serverTimestamp() // Para ordenar
        };

        // 4. Escribir en Firestore (colección 'propiedades')
        db.collection("propiedades").add(nuevaPropiedad)
            .then(() => {
                messageDisplay.textContent = "¡Propiedad añadida con éxito! Recargando listado...";
                messageDisplay.style.color = 'green';
                
                // 5. Limpiar formulario
                document.getElementById('new-titulo').value = '';
                document.getElementById('new-precio').value = '';
                document.getElementById('new-ciudad').value = '';
                document.getElementById('new-imagen').value = '';

                // 6. Recargar listado (la función principal de lectura)
                setTimeout(() => {
                    location.reload(); // La forma más simple de actualizar la lista
                }, 1500); // Esperar 1.5 segundos

            })
            .catch((error) => {
                console.error("Error al añadir documento: ", error);
                messageDisplay.textContent = "Error al añadir propiedad. Revisa la consola y las reglas de Firebase.";
                messageDisplay.style.color = 'red';
            });
    }

    // [AQUÍ VA LA FUNCIÓN DE LECTURA DE PROPIEDADES QUE YA TENÍAS]
    // ...
</script>
</body>
</html>